# 18. 반응형 아키텍처와 어니언 아키텍처

## 📝 핵심 내용

- ### 반응형 아키텍처
  - 반응형 아키텍처는 코드에 나타난 순차적인 액션의 순서를 뒤집는다. (X를 하고 Y를 하는 대신, X를 하면 무조건 Y를 하게 만드는 것!)
    - 감시자(옵저버)를 달아 어떤 것이 바뀔 때 실행되는 핸들러를 등록하는 방식으로 구현할 수 있다.
  - 반응형 아키텍처는 코드에 3가지 중요한 영향을 준다.
  - 1. 원인과 효과가 결합한 것을 분리한다!
  - 2. 여러 단계를 파이프라인으로 처리한다! (파이프라인은 순서대로 발생하는 작은 액션들의 조합이다.)
  - 3. 타임라인이 유연해진다!
  - 만약 원인과 효과의 중심이 없는 경우(순차적인 단계만 있고 항상 원인이 하나인 경우) 이 패턴을 사용하지 않는 것이 좋다.
  - 만약 여러 단계가 있지만 데이터를 전달하지 않는다면 이 패턴을 사용하지 않는 것이 좋다. 데이터를 전달하지 않으면 파이프라인이라고 볼 수 없다.
- ### 어니언 아키텍처
  - 어니언 아키텍처는 현실 세계와 상호작용하기 위한 서비스 구조를 만드는 방법이다. (서비스 전체를 구성하는 데 사용한다.)
  - 아래 3 계층이 겹겹이 쌓인 양파 모양을 하고 있다. - 1. 인터랙션 계층: 바깥세상에 영향을 주거나 받는 액션으로 이루어짐 - 사용자 인터페이스, 이벤트 처리 등 사용자와 상호작용하는 부분 - 외부 시스템(서버, DB 등)과 통신하는 부분
    프레젠테이션 로직 - 데이터를 화면에 렌더링하는 로직 - 2. 도메인 계층: 비즈니스 규칙을 정의하는 계산으로 이루어짐 - 비즈니스 로직 - 핵심 도메인 규칙과 엔터티 모델링 - 상태 관리 및 데이터 변환 로직 - 순수 함수와 불변성 지향 - 3. 언어 계층: 언어 유틸리티와 라이브러리로 이루어짐
  - 어니언 아키텍처 규칙 3가지!
    - 1. 현실 세계와 상호작용은 인터랙션 계층에서 해야 한다.
    - 2. 계층에서 호출하는 방향은 중심방향이다.
    - 3. 계층은 외부에 어떤 계층이 있는지 모른다.
  - 어니언 아키텍처는 인터랙션 계층을 바꾸기 쉽고, 도메인 계층을 재사용하기 좋다.
  - 도메인 계층과 인터렉션 계층을 분리해 도메인 규칙을 계산으로 유지할 수 있다!!
  - 인터렉션 계층에 속하는지 도메인 계층에 속하는지 판단하려면 코드에서 사용하는 용어를 보면 된다. 도메인 규칙은 도메인 용어를 사용한다.
    - 도메인 규칙에는 제품, 이미지, 가격, 할인과 같은 용어를 사용한다.
    - 반면, 데이터베이스, 새로운, 이전 데이터베이스도 도메인 용어가 아니다.

## ❣️ 느낀 점

- `중요한 것은 상태를 가능한 안전하게 사용하는 것입니다` 라는 말이 가장 핵심적으로 이야기하고 싶은 내용이라는 생각이 들었다. 상태가 변하더라도, 해당 상태를 안전하게 변경하고, 어떤 시점에서도 같은 상태를 유지할 수 있도록 하는 것이 중요하다는 생각이 들었다.

- 책에 나온 예시에서 `ValueCell` 은 상태, `FormulaCell`은 파생상태를 말한다.

  - 리코일 내부가 어떻게 구현되었는지 정확하게는 모르지만, `ValueCell` 은 `Atom`, `FormulaCell`은 `Selector` 로 대체할 수 있을 것 같다.

- 원인과 효과를 분리하여 중복을 줄이고, 신경써야 할 것을 줄이는 작업이 몹시 인상적이었다. 옵저버 패턴을 잘 사용하면 좋을 것 같다는 생각이 들었다.

- 어니언 아키텍처에서 인터렉션을 책임지는 부분의 일부가 UI라고 생각한다. 그래서 우리가 프리코스 때부터 계속 도메인과 UI를 분리하는 연습을 해온 것도 어니언 아키텍처로 가는 하나의 길이었다는 생각이 들었다.

## 🤔 궁금한 점 & 더 생각해볼 점

- 전역 상태로 관리되어야 할 것 과 지역으로 관리되어야 하는 것의 차이
- 상태로 가지고 있어야 할 것과 파생상태로 계산해야 하는 것의 차이
- 원시값 형태의 상태 여러개로 관리하는 것과 객체, 배열로 상태 하나로 관리하는 것의 차이

## 🚀 적용해본 점
