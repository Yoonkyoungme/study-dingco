# 18 반응형 아키텍처와 어니언 아키텍처

- 반응형 아키텍처
순차적 액션 단계에 사용

순차적 액션의 순서를 뒤집음.

- 어니언 아키텍처
서비스의 모든 단계에 사용.(서비스 전체)
현실세계와 상호작용하기 위한 서비스 구조를 만듬.
인터랙션 - 도메인 - 언어

=> 이게 MVP 같은건가?


## 반응형 아키텍처 
UI

=> 코드에 나타난 순차적 액션의 순서를 뒤집음,
=> 코드 읽기 쉽고 유지보수 쉬움

반응형 아키텍쳐 만드는 순서
- 원인과 효과가 결합한 것 분리
- 여러 단계를 파이프라인으로 처리
- 타임라인이 유연해짐.


### 셀
셀은 일급 상태이다.
전역 상태관리랑 비슷한듯
감시자 개념 추가 => 옵저버 = 리스너 = 이벤트 핸들러 = 콜백

셀이 바뀔 때 배송 아이콘 갱신

파생된 값 계산.
=> 감시하던 상위 셀 바뀌면 formulaCell 바뀜.
상위 셀 바뀌면 셀 다시 계산.


=> 함수형에의 valueCell
: 클로저 - atom , 리액트 - 리덕스 스토어와 리코일 아톰
...

### 반응형 아키텍쳐 - 원인과 효과가 결합된 것 분리
예)
제품 추가 버튼 클릭 => 전역 장바구니에 제품 추가, 배송 아이콘 업데이트
제품 삭제 클릭 => 전역 장바구니 제품 삭제, 배송 아이콘 업데이트 

여기서  배송 아이콘 업데이트가 겹쳐서 분리 후 하나만 만들어도 됨,

결합의 분리는 원인과 효과의 중심을 관리.
예)
장바구니 바꾸는 방법, 장바구니 바뀔떄의 액션

이때의 중심은 장바구니이다. 여기서 장바구니가 바뀔 때 할 일을 추가하면 장바구니 바꾸는 코드를 모두 고쳐야 한다.

그래서 원인- 결과를 분리해야한다.

-> 관심사 분리?

클릭 핸들러(제품 추가 클릭, 장바구니에 제품 추가) + 장바구니 변경 핸들러(장바구니 변경, 배송 아이콘 업데이트)

단 , 중심이 없다면(분리할 필요가 없다면) 분리하지 않는게 좋음

그렇다면 원인과 효과의 중심이 있다는것은 컴포넌트들이 서로에게 종속되어 있다는 뜻인가? => 그러면 전역으로 읽고 업데이트해야하는 상태가 있다는 것?

### 여러 단계를 파이프라인으로 처리
### 타임라인이 유연해짐
타임라인이 짧은게 좋지만, 공유하는 자원이 없다면 타임라인이 많아져도 문제가 없음.


## 어니언 아키텍처
바깥 세계와 상호작용 하는 부분 다룸. 반응형이 이 안에 있을 수 있음
- 인터랙션 : 바깥세상에 영향 주거나 받는 액션
- 도메인 계층: 비즈니스 규칙을 정의하는 계산
- 언어 계층: 언어 유틸리티와 라이브러리

=> 계층에서 호출하는 방향은 중심방향, 계층은 외부에 어떤 계층이 있는지 모름.

### 액션 , 계산 ,데이터
데이터 : 문자열, 컬렉션,,, 수동적이고 투명
계산 : 입력으로 출력 만드는 연산. 항상 입출력 동일. 호출시점, 횟수 영향 x
액션: 바깥세계에 영향을 주거나 받는 실행가능한 코드.

### 어니언 아키텍처의 장점
- 변경, 재사용이 쉬움
UI, Domain, 언어를 분리하기 때문에 유연하다.

전통적인 아키텍처: 웹 - 도메인 - DB 분리
어니언 아키텍처: 웹 - 핸들러 -> 디비 -> 자스
                       -> 언어  
웹-핸들러-디비 (인터랙션) - 언어, 도메인(도메인)

-> 어니언 아키텍처 -> 도메인에서 디비 사용해야한다면?
-> 도메인을 계산으로 만든다. 

### 도메인 규칙은 도메인 용어를 사용합니다.
도메인 규칙에는 제품, 이미지 ,가격 과 같은 **도메인 용어**를 사용함, 
즉 도메인 로직과 비즈니스 규칙과 같은 소프트웨어 동작으로 되어 있다. 대부분 계산으로 구성.

도메인 용어가 정확이 무엇인지