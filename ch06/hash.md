# 6,7장

데이터 중첩, 불변성

클로저, 하스켈에 구현되어있는 불변성이란?

리액트 불변성

자스는 직접 구현행함. 근데 클로저가 자스에있는내용아닌가/…???

쓰기(값바꾸기)를 읽기로 만들자! 카피온라이트

Q. 함수형 코딩에서 비동기처리

ex ) async func tree(){

      console.log(’df’);

}

는 return 값이 무조건 promise 니까

main 에서

{

const a = tree();

하게 되면 a 에는 promise 가 담김..

그래서 a에 promise 를 담지 않고싶은데 어떻게 처리해야할까

}

불변 데이터 읽는것은 계산, 변경 가능ㄴ한 데이터 읽는것은 액션

불변 데이터 구조(카피온라이트 같은거) 의 장점

변경 가능한 데이터보다 메모리를 더 많이쓰고 느림 그러나 ..

- 언제든 최적화 가능
- 가비지 콜렉터는 매우 빠름
- 생각보다 많이 복사하지 않음(얕은 복사,, `구조적 공유`. 같은 메모리를 가리키는 참조를 복사!!!)
- 함수형 프로그래밍언어에는 빠른 구현체가 있음! : 그 언어에서 불변데이터 구조 지원

### 클로저에서의 불변성

> 클로저는 함수와 함수가 선언된 렉시컬 환경의 조합이다.

> 자바스크립트 고유의 개념이 아니라 함수를 일급 객체로 취급하는 함수형 프로그래밍 언어

→ 영속 불변 `자료구조`!

불변 자료구조에서, 객체가 동등하다는 개념은 다른 의미를 갖습니다. 만약 두 객체가 같다면, 그 둘은 한 시점에서만 같은 것이 아니라, **영원히** 같습니다.

클로저는 지연 평가 시퀀스를 지원합니다. 이는 시퀀스에 대한 평가가 미리 이뤄지는 것 (ahead of time)이 아니라 연산의 결과로 그 때 그 때 이뤄짐을 뜻합니다.

[https://medium.com/happyprogrammer-in-jeju/클로저라는-훌륭한-도구와-영속-불변-자료-구조-4409d00f680b](https://medium.com/happyprogrammer-in-jeju/%ED%81%B4%EB%A1%9C%EC%A0%80%EB%9D%BC%EB%8A%94-%ED%9B%8C%EB%A5%AD%ED%95%9C-%EB%8F%84%EA%B5%AC%EC%99%80-%EC%98%81%EC%86%8D-%EB%B6%88%EB%B3%80-%EC%9E%90%EB%A3%8C-%EA%B5%AC%EC%A1%B0-4409d00f680b)

https://green-labs.github.io/start-your-clojure-project-now-1

### 리액트에서의 불변성

리액트는 함수형 프로그래밍을 지향한다.

리액트는 상태값을 업데이트 할 때 얕은 비교를 수행하기 때문에 깊은 복사, 얕은 복사 등을 통해 값을 복사 후 수정해야함!

원본 데이터 수정하지 않아 사이드이펙트 방지.

---

레거시 코드 : 오래전에 만든것, 지금 당장 고칠 수 없어 그대로 사용해야하는 코드

### 방어적 복사

데이터 나기기 전. 들어올 때 깊은 복사 해주기

ex) 웹 api, 얼랭 , 엘릭서

깊은 복사 → lodash 라이브러리의 깊은 복사!!! cloneDeep 살펴보기
