# 16. 타임라인 사이에 자원 공유하기

## 📝 핵심 내용

- 좋은 타임라인의 원칙 5가지

  - 1. 타임라인은 적을수록 이해하기 쉽다.
  - 2. 타임라인을 짧을수록 이해하기 쉽다.
  - 3. 공유하는 자원이 적을수록 이해하기 쉽다.
  - 4. 자원을 공유해야 한다면 서로 조율해야 한다.
  - 5. 시간을 일급으로 다룬다.

- 타이밍 문제는 재현하기도, 테스트하기도 어려움으로 타임라인 다이어그램을 그려 분석하고 해결하는 것이 좋다.
- 타임라인은 자원을 안전하게 공유해야 한다. 안전하게 공유한다는 것은 올바른 순서대로 자원을 쓰고 돌려준다는 것이다. 즉, 타인라인의 실행 가능한 순서를 줄여 올바른 결과가 나오지 않도록 하는 것이다.
- 동시성 기본형은 자원을 안전하게 공유할 수 있는 재사용 가능한 코드를 말한다.

  - 큐를 활용하여 자원을 안전하게 공유할 수 있다. (**큐는 동시성 기본형**이다.)
    - 동시성 기본형은 자원을 안전하게 공유할 수 있는 재사용 가능한 코드를 말한다.
  - 큐는 **액션에 순서 보장** 슈퍼파워를 주는 도구로 볼 수 있다.
  - 큐는 함수를 인자로 받아 또 다른 함수를 리턴하는 고차함수이다.

    ```js
    function Queue(worker) {
      const queueItems = [];
      let working = false;

      function runNext() {
        if (working || queueItems.length === 0) return;
        working = true;

        const item = queueItems.shift();
        worker(item.data, function (val) {
          working = false;
          setTimeout(item.callback, 0, val);
          runNext();
        });
      }

      return function(data, callback){
        queueItems.push({
            data: data,
            callback: callback || ()=>{}
        })
        setTimeout(runNext, 0)
      }
    }


    const updateTotalQueue = Queue(calcCartWorker)

    function calcCartWorker(cart, done){
        calcCartTotal(cart, function(total){
            updateTotalDom(total)
            done(total)
        })
    }
    ```

## ❣️ 느낀 점

- '사람들은 항상 무엇인가를 문제없이 공유합니다. 사람을 통해 배우세요'라는 문장이 인상깊었다. 생각해보면 현실 세계에 있는 것들을 컴퓨터 세상으로 잘 옮기기 위한 노력들이 많은 것 같다.

## 🤔 궁금한 점 & 더 생각해볼 점

- 동시성 기본형 모델을 잘 활용한 사례 `이벤트 루프`

  - 자바스크립트의 이벤트 루프는 자바스크립트의 동시성 모델의 핵심 요소로, 비동기 작업을 처리하고 이벤트를 관리하는 중요한 메커니즘입니다.
  - 이벤트 루프의 작동 원리

    ```
    이벤트 루프는 다음과 같은 과정을 반복적으로 수행합니다:

    콜 스택 확인: 콜 스택이 비어 있는지 확인합니다.
    태스크 큐 확인: 태스크 큐에 대기 중인 작업이 있는지 확인합니다. 있다면 이를 콜 스택으로 이동하여 실행합니다.
    마이크로태스크 큐 확인: 마이크로태스크 큐에 대기 중인 작업이 있는지 확인합니다. 있다면 이를 콜 스택으로 이동하여 실행합니다.
    렌더링 단계: 브라우저의 경우 렌더링 단계가 포함되어 화면을 업데이트합니다.
    이 과정이 계속 반복되면서 자바스크립트는 비동기 작업을 처리하고 이벤트를 관리합니다.
    ```

- `Queue` 이외에 자원을 안전하게 공유할 수 있는 방법 소개
  - 뮤텍스 (Mutex)
    - 뮤텍스는 "Mutual Exclusion"의 약자로, 공유 자원에 대한 상호 배제를 보장하는 메커니즘입니다. 뮤텍스는 한 번에 하나의 스레드만 공유 자원에 접근할 수 있도록 합니다. 뮤텍스를 사용하면 경쟁 상태(Race Condition)를 방지할 수 있습니다.
  - 세마포어 (Semaphore)
    - 세마포어는 뮤텍스와 유사하지만, 동시에 허용할 수 있는 스레드의 수를 지정할 수 있는 메커니즘입니다. 세마포어는 주로 제한된 자원을 관리할 때 사용됩니다. 예를 들어, 네트워크 연결 수를 제한하거나 데이터베이스 연결 풀을 관리할 때 유용합니다.
  - 뮤텍스는 한 번에 하나의 스레드만 자원에 접근하도록 보장합니다. 단일 자원 보호에 적합합니다. 반면, 세마포어는 한 번에 여러 스레드가 자원에 접근할 수 있도록 허용합니다. 최대 동시 접근 스레드 수를 지정할 수 있어, 제한된 자원을 관리하는 데 유용합니다. 이 두 가지 도구를 적절히 사용하면 멀티스레드 환경에서 자원을 안전하게 공유할 수 있습니다.

## 🚀 적용해본 점
