# 타임라인 격리하기

## 타임라인 다이어그램

예) 장바구니 추가에서 빠르게 두번 클릭 시 일어날 수 있는 버그
사용자 클릭 시 돔 업데이트가 끝난 후에 다음 사용자 클릭이 일어날 수 있도록 해야함.

## 두가지 타임라인 다이어그램 기본 규칙

1. 두 액션이 순서대로 나타나면 같은 타임라인에 넣는다.
   => 타임라인에는 액션만 넣는다(계산은 실행 시점에 영향받지 않음)
2. 두 액션이 동시에 실행되거나 순서를 예상할 수 없다면 분리된 타임라인에 넣음.
   => 액션을 서로 다른 스레드, 프로세스, 기계, 비동기 콜백에서 실행되면 서로 다른 타임라인에 표시한다.=> 즉 서로 다른 비동기 콜백에서 실행 => 실행 시점이 무작위라 어떤 액션이 먼저 실행될 지 모름.

===
옛날 프로젝트 할 때 useState 로 동시에 여러번 클릭되는거 막았는데 그거랑 다른건가?

## 액션 순서에 관한 두가지 사실

1. ++, += 는 3 단계이다. : 읽기, 더하기, 쓰기
2. 인자는 함수를 부르기 전에 실행한다. : 함수에 인자를 전달하면서 실행하면 함수에 전달되기 전에 실행된다.

## 비동기 호출은 새로운 타임라인으로 그린다.

비동기 호출의 내부 로직은 타임라인 나눈다.

## 순서대로 실행되는 코드에도 두 가지 종류 있음

1. 순서 섞일 수도 있는 코드
   -> 다른 타임라인에 있는 액션이 끼어들 수있음 => 멀티스레드
2. 순서가 섞이지 않는 코드406페이지 다시보기
   -> 끼어들 수 없음. => 단일 스레드 => 자스

## 좋은 타임라인의 원칙

1. 타임라인은 적을수록 이해하기 쉽다
2. 타임라인은 짧을수록 이해하기 쉽다
3. 공유하는 자원이 적을수록 이해하기 쉽다
4. 자원을 공유한다면 서로 조율해야함. => 올바른 결과를 주지 않는 실행순서 없애는 것
5. 시간을 일급으로 다룬다.

## 자바스크립트의 비동기 큐

작업 큐는 이벤트 루프에 의해 처리. 이벤트, 비동기 동작이 호출되면 콜백은 작업 큐에 추가된다.
=> 예측 불가능한 시점에 추가.
만약 작업이 없다면 엔진은..? => 이벤트 루프는 대기 상태로 들어가고 전원을 아낀다. or 가비지컬렉션

## 자바스크립트에서 단순화 하기 위한 두 단계

1. 액션 통합하기(자바스크립트는 스레드가 하나이기 때문에 액션은 순서가 섞이지 않고 하나의 타임라인에서 실행할 수 있음)
2. 타임라인 통합하기

## 자원을 공유하는 타임라인은 문제가 생길 수 있다.

지역변수로 바꿀 수 있는 변수는 지역변수로 바꾸자.

## 동기함수 vs 비동기 함수

- 동기함수
  호출하는 곳에서 리턴값을 사용할 수 있다.
  액션을 빼내기 위해 액션을 부르는 곳은 리턴값으로 바꾸고 액션에 리턴값을 인자로 전달한다.
- 비동기함수
  미래에 어떤 시점에 콜백을 통해 결과를 받는다.
  액션을 뺴내기 위해 액션을 부르는 곳은 콜백을 부르도록 바꾸고 액션을 콜백으로 전달한다.
